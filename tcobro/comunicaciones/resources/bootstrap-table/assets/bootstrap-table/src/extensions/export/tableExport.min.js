!function(t){t.fn.extend({tableExport:function(e){function n(e,n,o,a){-1==y.ignoreRow.indexOf(o)&&t(e).filter(":visible").find(n).each(function(e){if(("always"==t(this).data("tableexport-display")||"none"!=t(this).css("display")&&"hidden"!=t(this).css("visibility")&&"none"!=t(this).data("tableexport-display"))&&-1==y.ignoreColumn.indexOf(e)&&"function"==typeof a){var n=0;if("undefined"!=typeof x[o]&&x[o].length>0)for(c=0;c<=e;c++)"undefined"!=typeof x[o][c]&&(a(null,o,c),delete x[o][c],e++);if(a(this,o,e),t(this).is("[colspan]"))for(n=t(this).attr("colspan"),c=0;c<n-1;c++)a(null,o,e+c);if(t(this).is("[rowspan]")){var i=parseInt(t(this).attr("rowspan"));for(r=1;r<i;r++)for("undefined"==typeof x[o+r]&&(x[o+r]=[]),x[o+r][e]="",c=1;c<n;c++)x[o+r][e+c]=""}}})}function o(t){if(y.consoleLog===!0&&console.log(t.output()),"string"==y.outputMode)return t.output();if("base64"==y.outputMode)return m(t.output());try{var e=t.output("blob");saveAs(e,y.fileName+".pdf")}catch(n){p(y.fileName+".pdf","data:application/pdf;base64,"+m(t.output()))}}function a(t){return t.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function i(t,e,n){return t.replace(new RegExp(a(e),"g"),n)}function l(t,e,n){var o="";if(null!=t){var r=s(t,e,n),a=null===r||""==r?"":r.toString();r instanceof Date?o=y.csvEnclosure+r.toLocaleString()+y.csvEnclosure:(o=i(a,y.csvEnclosure,y.csvEnclosure+y.csvEnclosure),(o.indexOf(y.csvSeparator)>=0||/[\r\n ]/g.test(o))&&(o=y.csvEnclosure+o+y.csvEnclosure))}return o}function s(e,n,o){var r="";if(null!=e){var a=t(e);r=y.htmlContent===!0?a.html().trim():a.text().trim().replace(/\u00AD/g,""),y.escape===!0&&(r=escape(r)),"function"==typeof y.onCellData&&(r=y.onCellData(a,n,o,r))}return r}function f(t,e,n){return e+"-"+n.toLowerCase()}function d(t,e){try{return window.getComputedStyle?(e=e.replace(/([a-z])([A-Z])/,f),window.getComputedStyle(t,null).getPropertyValue(e)):t.currentStyle?t.currentStyle[e]:t.style[e]}catch(n){}return""}function u(t,e,n){var o=100,r=d(t,e),a=r.match(/\d+/);if(null!==a){a=a[0];var i=document.createElement("div");i.style.overflow="hidden",i.style.visibility="hidden",t.parentElement.appendChild(i),i.style.width=o+n;var l=o/i.offsetWidth;return t.parentElement.removeChild(i),a*l}return 0}function p(t,e){var n=document.createElement("a");n&&(document.body.appendChild(n),n.style="display: none",n.download=t,n.href=e,document.createEvent?(null==v&&(v=document.createEvent("MouseEvents")),v.initEvent("click",!0,!1),n.dispatchEvent(v)):document.createEventObject?n.fireEvent("onclick"):"function"==typeof n.onclick&&n.onclick(),document.body.removeChild(n))}function h(t){t=t.replace(/\x0d\x0a/g,"\n");for(var e="",n=0;n<t.length;n++){var o=t.charCodeAt(n);128>o?e+=String.fromCharCode(o):o>127&&2048>o?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e}function m(t){var e,n,o,r,a,i,l,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",f=0;for(t=h(t);f<t.length;)e=t.charCodeAt(f++),n=t.charCodeAt(f++),o=t.charCodeAt(f++),r=e>>2,a=(3&e)<<4|n>>4,i=(15&n)<<2|o>>6,l=63&o,isNaN(n)?i=l=64:isNaN(o)&&(l=64),c=c+s.charAt(r)+s.charAt(a)+s.charAt(i)+s.charAt(l);return c}var y={consoleLog:!1,csvEnclosure:'"',csvSeparator:",",csvUseBOM:!0,displayTableName:!1,escape:!1,excelstyles:["border-bottom","border-top","border-left","border-right"],fileName:"tableExport",htmlContent:!1,ignoreColumn:[],ignoreRow:[],jspdf:{orientation:"p",unit:"pt",format:"a4",margins:{left:20,right:10,top:10,bottom:10},autotable:{padding:2,lineHeight:12,fontSize:8,tableExport:{onAfterAutotable:null,onBeforeAutotable:null,onTable:null}}},onCellData:null,outputMode:"file",tbodySelector:"tr",theadSelector:"tr",tableName:"myTableName",type:"csv",worksheetName:"xlsWorksheetName"},g=this,v=null,b=0,x=[],w="";if(t.extend(!0,y,e),"csv"==y.type||"txt"==y.type){var C="";if(b=0,t(g).find("thead").first().find(y.theadSelector).each(function(){w="",n(this,"th,td",b,function(t,e,n){w+=l(t,e,n)+y.csvSeparator}),w=t.trim(w).substring(0,w.length-1),w.length>0&&(C.length>0&&(C+="\n"),C+=w),b++}),t(g).find("tbody").first().find(y.tbodySelector).each(function(){w="",n(this,"td",b,function(t,e,n){w+=l(t,e,n)+y.csvSeparator}),w=t.trim(w).substring(0,w.length-1),w.length>0&&(C.length>0&&(C+="\n"),C+=w),b++}),C+="\n",y.consoleLog===!0&&console.log(C),"string"===y.outputMode)return C;if("base64"===y.outputMode)return m(C);try{var E=new Blob([("csv"==y.type&&y.csvUseBOM?"\ufeff":"")+C],{type:"text/"+("csv"==y.type?"csv":"plain")+";charset=utf-8"});saveAs(E,y.fileName+"."+y.type)}catch(S){p(y.fileName+"."+y.type,"data:text/"+("csv"==y.type?"csv":"plain")+";charset=utf-8,"+("csv"==y.type&&y.csvUseBOM?"\ufeff":"")+encodeURIComponent(C))}}else if("sql"==y.type){b=0;var N="INSERT INTO `"+y.tableName+"` (";if(t(g).find("thead").first().find(y.theadSelector).each(function(){n(this,"th,td",b,function(t,e,n){N+="'"+s(t,e,n)+"',"}),b++,N=t.trim(N),N=t.trim(N).substring(0,N.length-1)}),N+=") VALUES ",t(g).find("tbody").first().find(y.tbodySelector).each(function(){w="",n(this,"td",b,function(t,e,n){w+="'"+s(t,e,n)+"',"}),w.length>3&&(N+="("+w,N=t.trim(N).substring(0,N.length-1),N+="),"),b++}),N=t.trim(N).substring(0,N.length-1),N+=";",y.consoleLog===!0&&console.log(N),"string"==y.outputMode)return N;if("base64"==y.outputMode)return m(N);try{var E=new Blob([N],{type:"text/plain;charset=utf-8"});saveAs(E,y.fileName+".sql")}catch(S){p(y.fileName+".sql","data:application/sql;charset=utf-8,"+encodeURIComponent(N))}}else if("json"==y.type){var A=[];t(g).find("thead").first().find(y.theadSelector).each(function(){var t=[];n(this,"th,td",b,function(e,n,o){t.push(s(e,n,o))}),A.push(t)});var j=[];t(g).find("tbody").first().find(y.tbodySelector).each(function(){var t=[];n(this,"td",b,function(e,n,o){t.push(s(e,n,o))}),t.length>0&&(1!=t.length||""!=t[0])&&j.push(t),b++});var k=[];k.push({header:A,data:j});var M=JSON.stringify(k);if(y.consoleLog===!0&&console.log(M),"string"==y.outputMode)return M;var T=m(M);if("base64"==y.outputMode)return T;try{var E=new Blob([M],{type:"application/json;charset=utf-8"});saveAs(E,y.fileName+".json")}catch(S){p(y.fileName+".json","data:application/json;charset=utf-8;base64,"+T)}}else if("xml"===y.type){b=0;var O='<?xml version="1.0" encoding="utf-8"?>';O+="<tabledata><fields>",t(g).find("thead").first().find(y.theadSelector).each(function(){n(this,"th,td",b,function(t,e,n){O+="<field>"+s(t,e,n)+"</field>"}),b++}),O+="</fields><data>";var B=1;if(t(g).find("tbody").first().find(y.tbodySelector).each(function(){var t=1;w="",n(this,"td",b,function(e,n,o){w+="<column-"+t+">"+s(e,n,o)+"</column-"+t+">",t++}),w.length>0&&"<column-1></column-1>"!=w&&(O+='<row id="'+B+'">'+w+"</row>",B++),b++}),O+="</data></tabledata>",y.consoleLog===!0&&console.log(O),"string"==y.outputMode)return O;var T=m(O);if("base64"==y.outputMode)return T;try{var E=new Blob([O],{type:"application/xml;charset=utf-8"});saveAs(E,y.fileName+".xml")}catch(S){p(y.fileName+".xml","data:application/xml;charset=utf-8;base64,"+T)}}else if("excel"==y.type||"doc"==y.type){b=0;var L="<table>";t(g).find("thead").first().find(y.theadSelector).each(function(){w="",n(this,"th,td",b,function(e,n,o){if(null!=e){w+="<td style='";for(var r in y.excelstyles)y.excelstyles.hasOwnProperty(r)&&(w+=y.excelstyles[r]+": "+t(e).css(y.excelstyles[r])+";");w+="'>"+s(e,n,o)+"</td>"}}),w.length>0&&(L+="<tr>"+w+"</tr>"),b++}),t(g).find("tbody").first().find(y.tbodySelector).each(function(){w="",n(this,"td",b,function(e,n,o){if(null!=e){w+="<td style='";for(var r in y.excelstyles)y.excelstyles.hasOwnProperty(r)&&(w+=y.excelstyles[r]+": "+t(e).css(y.excelstyles[r])+";");t(e).is("[colspan]")&&(w+="' colspan='"+t(e).attr("colspan")),t(e).is("[rowspan]")&&(w+="' rowspan='"+t(e).attr("rowspan")),w+="'>"+s(e,n,o)+"</td>"}}),w.length>0&&(L+="<tr>"+w+"</tr>"),b++}),y.displayTableName&&(L+="<tr><td></td></tr><tr><td></td></tr><tr><td>"+s(t("<p>"+y.tableName+"</p>"))+"</td></tr>"),L+="</table>",y.consoleLog===!0&&console.log(L);var U="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:"+y.type+"' xmlns='http://www.w3.org/TR/REC-html40'>";if(U+='<meta http-equiv="content-type" content="application/vnd.ms-'+y.type+'; charset=UTF-8">',U+='<meta http-equiv="content-type" content="application/',U+="excel"===y.type?"vnd.ms-excel":"msword",U+='; charset=UTF-8">',U+="<head>","excel"===y.type&&(U+="<!--[if gte mso 9]>",U+="<xml>",U+="<x:ExcelWorkbook>",U+="<x:ExcelWorksheets>",U+="<x:ExcelWorksheet>",U+="<x:Name>",U+=y.worksheetName,U+="</x:Name>",U+="<x:WorksheetOptions>",U+="<x:DisplayGridlines/>",U+="</x:WorksheetOptions>",U+="</x:ExcelWorksheet>",U+="</x:ExcelWorksheets>",U+="</x:ExcelWorkbook>",U+="</xml>",U+="<![endif]-->"),U+="</head>",U+="<body>",U+=L,U+="</body>",U+="</html>","string"==y.outputMode)return U;var T=m(U);if("base64"===y.outputMode)return T;var W="excel"===y.type?"xls":"doc";try{var E=new Blob([U],{type:"application/vnd.ms-"+y.type});saveAs(E,y.fileName+"."+W)}catch(S){p(y.fileName+"."+W,"data:application/vnd.ms-"+y.type+";base64,"+T)}}else if("png"==y.type)html2canvas(t(g),{onrendered:function(t){var e=t.toDataURL();e=e.substring(22);for(var n=atob(e),o=new ArrayBuffer(n.length),r=new Uint8Array(o),a=0;a<n.length;a++)r[a]=n.charCodeAt(a);try{var i=new Blob([o],{type:"image/png"});saveAs(i,y.fileName+".png")}catch(l){p(y.fileName+".png","data:image/png;base64,"+e)}}});else if("pdf"==y.type)if(y.jspdf.autotable===!1){var D={dim:{w:u(t(g).first().get(0),"width","mm"),h:u(t(g).first().get(0),"height","mm")},pagesplit:!1},R=new jsPDF(y.jspdf.orientation,y.jspdf.unit,y.jspdf.format);R.addHTML(t(g).first(),y.jspdf.margins.left,y.jspdf.margins.top,D,function(){o(R)})}else{var F=y.jspdf.autotable.tableExport;if("string"==typeof y.jspdf.format&&"bestfit"===y.jspdf.format.toLowerCase()){var P={a0:[2383.94,3370.39],a1:[1683.78,2383.94],a2:[1190.55,1683.78],a3:[841.89,1190.55],a4:[595.28,841.89]},q="",I="",z=0;t(g).filter(":visible").each(function(){if("none"!=t(this).css("display")){var e=u(t(this).get(0),"width","pt");if(e>z){e>P.a0[0]&&(q="a0",I="l");for(var n in P)P.hasOwnProperty(n)&&P[n][1]>e&&(q=n,I="l",P[n][0]>e&&(I="p"));z=e}}}),y.jspdf.format=""==q?"a4":q,y.jspdf.orientation=""==I?"w":I}F.doc=new jsPDF(y.jspdf.orientation,y.jspdf.unit,y.jspdf.format),t(g).filter(":visible").each(function(){if("none"!=t(this).css("display")){var e,o=0,r={};if(F.columns=[],F.rows=[],F.rowoptions={},"function"==typeof F.onTable&&F.onTable(t(this),y)===!1)return!0;Object.keys(y.jspdf.autotable).forEach(function(t){r[t]=y.jspdf.autotable[t]}),r.margins={},t.extend(!0,r.margins,y.jspdf.margins),"function"!=typeof r.renderCell&&(r.renderCell=function(t,e,n,o,r,a,i,l){var s=l.tableExport.doc,c=0;if(s.setFillColor(i%2===0?245:255),s.setTextColor(50),s.rect(t,e,n,o,"F"),e+=l.lineHeight/2+s.autoTableTextHeight()/2-2.5,"undefined"!=typeof l.tableExport.columns[r]){var f=l.tableExport.columns[r];if("undefined"!=typeof f.style){var d=f.style.align,u=l.tableExport.rowoptions[i+1+":"+r];"undefined"!=typeof u&&(d=u.style.align),"right"==d?c=n-s.getStringUnitWidth(""+a)*s.internal.getFontSize()-l.padding:"center"==d&&(c=(n-s.getStringUnitWidth(""+a)*s.internal.getFontSize())/2)}}c<l.padding&&(c=l.padding),s.text(a,t+c,e)}),t(this).find("thead").find(y.theadSelector).each(function(){e=0,n(this,"th,td",o,function(t,n,o){var r={title:s(t,n,o),key:e++,style:{align:d(t,"text-align"),bcolor:d(t,"background-color")}};F.columns.push(r)}),o++}),t(this).find("tbody").find(y.tbodySelector).each(function(){var t=[],r=0;e=0,n(this,"td",o,function(n,o,a){var i={style:{align:d(n,"text-align"),bcolor:d(n,"background-color")}};F.rowoptions[r+":"+e++]=i,t.push(s(n,o,a))}),t.length&&(F.rows.push(t),r++),o++}),"function"==typeof F.onBeforeAutotable&&F.onBeforeAutotable(t(this),F.columns,F.rows,r),F.doc.autoTable(F.columns,F.rows,r),"function"==typeof F.onAfterAutotable&&F.onAfterAutotable(t(this),r),y.jspdf.autotable.startY=F.doc.autoTableEndPosY()+r.margins.top}}),o(F.doc),F.columns.length=0,F.rows.length=0,delete F.doc,F.doc=null}return this}})}(jQuery);